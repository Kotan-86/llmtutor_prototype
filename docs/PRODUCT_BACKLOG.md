# プロダクトバックログ（1日粒度）

学習振り返り支援システム改良のプロダクトバックログ。1アイテム ≒ 1人日で切り、GitHub Issue に落とし込んで管理する。

**前提**: 数人〜十数人で自動更新＋履歴付きチューターが確実に動くこと。LAD は学習者向けメタ認知的モニタリング。対話履歴は DB 格納。LAD は「データ更新あり」アラート＋ロード時更新でコストを抑える。

---

## Day 1: 対話履歴の保存設計

**概要**: セッションID方針・DB選定（SQLite 等）・テーブルスキーマ（session_id, role, content, created_at 等）を決め、README または docs にメモする。

**受け入れ条件**
- [ ] スキーマと選定理由が文書化されている。

**見積もり**: 1人日  
**依存**: なし  
**ラベル**: `product-backlog`, `priority: high`, `theme: history`

---

## Day 2: 対話履歴の永続化実装

**概要**: app.py でセッションIDを発行し、チャット送受信のたびにDBに保存する。

**受け入れ条件**
- [ ] 同一セッションで複数往復してもDBに記録される。

**見積もり**: 1人日  
**依存**: Day 1  
**ラベル**: `product-backlog`, `priority: high`, `theme: history`

---

## Day 3: プロンプトへの履歴組み込み

**概要**: DBから直近 N ターン（またはトークン上限に合わせて）取得し、プロンプトに含める。必要なら古い部分は要約する方針を決める。

**受け入れ条件**
- [ ] 連続した対話で文脈が維持されている。

**見積もり**: 1人日  
**依存**: Day 2  
**ラベル**: `product-backlog`, `priority: high`, `theme: history`

---

## Day 4: LAD「データ更新あり」アラート＋ロード時更新

**概要**: バックエンドで「最後にログが更新された時刻」を返す API を用意し、フロントでロード時または一定間隔で比較。「更新あり」ならアラート表示し、表示データを再取得する。

**受け入れ条件**
- [ ] 学習者がページを開き直す／リロードすると最新データが反映される。
- [ ] 更新があった場合にアラートが出る。

**見積もり**: 1人日  
**依存**: なし（並行可能）  
**ラベル**: `product-backlog`, `priority: high`, `theme: lad`, `theme: data`

---

## Day 5: 学習者向けLAD表示の設計

**概要**: 学習者向けメタ認知モニタリングとして、何をどの画面に表示するか（視聴ログの簡易グラフ、小テスト結果の要約など）を仕様としてまとめる。

**受け入れ条件**
- [ ] 表示項目とデータソースが文書化されている。

**見積もり**: 1人日  
**依存**: なし  
**ラベル**: `product-backlog`, `priority: high`, `theme: lad`

---

## Day 6: 視聴ログ・小テストの簡易グラフ実装（Chart.js）

**概要**: app.py またはフロントに、学習者本人の視聴ログ・小テスト結果を Chart.js で表示する画面を追加する。

**受け入れ条件**
- [ ] 学習者が自分のログをグラフで確認できる。

**見積もり**: 1人日  
**依存**: Day 5  
**ラベル**: `product-backlog`, `priority: high`, `theme: lad`

---

## Day 7: 実験者向けデータ参照の整理

**概要**: 学習者向けは「ロード時更新＋アラート」で完結している前提で、実験者向けの集計・ダッシュボードをどうするか（現状の手動アップロード削減や、別ツールの検討）を方針としてまとめる。

**受け入れ条件**
- [ ] 方針が文書化されている。
- [ ] 必要なら最小限の手順が書かれている。

**見積もり**: 1人日  
**依存**: なし  
**ラベル**: `product-backlog`, `priority: medium`, `theme: data`

---

## Day 8: 字幕データの取得・整形とストア

**概要**: 動画字幕の取得方法を決め、テキストを整形してDBまたはファイルで保存する。

**受け入れ条件**
- [ ] 字幕が構造化されて保存されている。
- [ ] 後段のRAGで参照できる。

**見積もり**: 1人日  
**依存**: なし  
**ラベル**: `product-backlog`, `priority: medium`, `theme: rag`

---

## Day 9: 字幕のRAG統合

**概要**: 対話クエリに基づき字幕を検索し、プロンプトに含める（RAGまたは固定コンテキスト）。

**受け入れ条件**
- [ ] 「動画のここが難しかった」に答えるときに、該当箇所の字幕が参照されている。

**見積もり**: 1人日  
**依存**: Day 8  
**ラベル**: `product-backlog`, `priority: medium`, `theme: rag`

---

## 運用メモ

- 各アイテムは GitHub Issue に 1 件ずつ作成し、ラベルと Project で管理する。
- テンプレート: `.github/ISSUE_TEMPLATE/product_backlog_item.md`
- タイトル例: `【PBL】Day1: 対話履歴の保存設計`
